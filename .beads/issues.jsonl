{"id":"saf-site-vitepress-2k2","title":"EPIC: Core Layouts","description":"Build foundational page layouts: home, doc pages with typography, browse pages pattern. These are required before content migration.","status":"open","priority":0,"issue_type":"epic","created_at":"2026-01-12T17:23:41.751349-05:00","created_by":"alippold","updated_at":"2026-01-12T17:23:41.751349-05:00","dependencies":[{"issue_id":"saf-site-vitepress-2k2","depends_on_id":"saf-site-vitepress-42k","type":"blocks","created_at":"2026-01-12T17:25:03.983567-05:00","created_by":"alippold"},{"issue_id":"saf-site-vitepress-2k2","depends_on_id":"saf-site-vitepress-npl","type":"blocks","created_at":"2026-01-12T17:25:04.122509-05:00","created_by":"alippold"},{"issue_id":"saf-site-vitepress-2k2","depends_on_id":"saf-site-vitepress-dst","type":"blocks","created_at":"2026-01-12T17:25:04.265525-05:00","created_by":"alippold"},{"issue_id":"saf-site-vitepress-2k2","depends_on_id":"saf-site-vitepress-5es","type":"blocks","created_at":"2026-01-12T17:25:04.386326-05:00","created_by":"alippold"},{"issue_id":"saf-site-vitepress-2k2","depends_on_id":"saf-site-vitepress-dfg","type":"blocks","created_at":"2026-01-12T18:46:06.245135-05:00","created_by":"alippold"}]}
{"id":"saf-site-vitepress-33i","title":"PROJECT CONTEXT: VitePress POC for SAF Site","description":"## Project Overview\n\n**Goal**: Evaluate VitePress as replacement for Nuxt for MITRE SAF documentation site (open source version)\n\n**Why VitePress?**\n- Separate visual identity from commercial product (which uses Nuxt UI)\n- Avoid brand confusion between OSS and commercial offerings\n- Potentially better performance and simpler hosting (static site)\n- Built-in local search, good documentation tooling\n\n**Repository**: https://github.com/mitre/saf-site-vitepress\n**Original Nuxt repo**: `/Users/alippold/github/mitre/saf-site-v4`\n\n## Success Criteria\n\nThis POC needs to prove VitePress can handle:\n1. **Complex relational data**: Profiles, hardening guides, standards with FK relationships\n2. **Interactive features**: Client-side filters, search, browse pages\n3. **Production-quality components**: Good defaults, accessible, maintainable\n4. **Static site generation**: Fast builds, good bundle size\n5. **Content architecture**: Pocketbase database with VitePress data loaders\n\n## Content Management Architecture (APPROVED)\n\n**Decision (Sessions 014-015)**: Pocketbase is the content management system and single source of truth\n\n**Why Pocketbase**:\n- Relational database with FK constraints enforced at DB level\n- FK expansion via REST API (`?expand=org,team,tech`)\n- Version control via sqlite-diffable (git-friendly NDJSON)\n- No intermediate exports (database is source of truth)\n\n**Content Workflow**:\n```\nEdit in Pocketbase → Export DB (sqlite-diffable) → Commit → VitePress queries Pocketbase API → Build static site\n```\n\n**Why NOT YAML exports**:\n- Creates duplicate data (database + flat files)\n- Loses relational integrity\n- Manual FK resolution required\n- Defeats purpose of using a database\n\n**Data Architecture**:\n- 12 Pocketbase collections (base, with FKs, junction tables)\n- 78 validation profiles, 5 hardening profiles\n- 52 tags, 16 organizations, 8 technologies, 18 standards, 4 teams, 7 tools\n- All FK relationships enforced and expandable via API\n\n## High-Level Work Tracks\n\n### Track 1: Core Infrastructure ✅ COMPLETE\n- ✅ Establish layout patterns (doc vs page)\n- ✅ Choose component library (Reka UI approved)\n- ✅ Build reusable page layouts (browse pages with full-width)\n- ✅ Set up Pocketbase content management\n- ✅ Database version control with sqlite-diffable\n- ✅ Data import from YAML (one-time migration)\n\n### Track 2: VitePress Integration (IN PROGRESS)\n- Update VitePress data loaders to query Pocketbase API\n- Test browse pages with real Pocketbase data\n- Verify FK expansion in filters/displays\n- Create dynamic routes for detail pages\n- Migrate remaining browse pages (hardening, standards, apps)\n\n### Track 3: Production Evaluation\n- Build performance testing\n- Bundle size analysis\n- Search quality validation\n- Deployment strategy (CI/CD with Pocketbase)\n- Final decision: VitePress vs Nuxt\n\n## Key Constraints\n\n- **NO commercial product references** in code/docs/beads\n- Use hub-spoke pattern in beads (NOT markdown documentation files)\n- This is production evaluation, not just a POC throwaway\n- Database is single source of truth (no YAML exports)\n\n## Tech Stack\n\n- **Framework**: VitePress 1.6.4\n- **Components**: Reka UI 2.7.0 (headless, Vue-native)\n- **Data**: Pocketbase 0.23.9 (relational database, REST API)\n- **Version Control**: sqlite-diffable (git-friendly NDJSON exports)\n- **Data Loaders**: VitePress data loaders query Pocketbase API at build time\n- **Styling**: VitePress default theme + MITRE branding\n- **Search**: VitePress built-in local search\n\n## Current Status\n\n**What's Working**:\n- Browse page with filters (validation profiles)\n- Full-width layout with proper typography\n- Client-side reactive filtering\n- MITRE branding colors\n- Pocketbase content management with 12 collections\n- Database version control (NDJSON format)\n- All data imported and queryable\n\n**Next Major Milestone**: Complete VitePress data loader integration with Pocketbase API","status":"open","priority":0,"issue_type":"epic","created_at":"2026-01-12T17:34:28.228194-05:00","created_by":"alippold","updated_at":"2026-01-13T14:28:36.872896-05:00"}
{"id":"saf-site-vitepress-3kb","title":"SESSION 017: Execute Taxonomy Transformation","description":"SESSION 017 - Taxonomy Transformation Execution\n\nCOMPLETED THIS SESSION:\n✅ Identified data quality issues (56/78 profiles marked \"Cross Platform\")\n✅ Designed clean taxonomy structure (Target Type, OS Family, Category, Vendor)\n✅ Created visual mockups and filter UX design\n✅ Wrote complete 5-phase implementation plan (3-4 hours)\n✅ Saved all planning docs to docs/taxonomy/ (51k documentation)\n✅ Fixed dropdown transparency issue (global styles for portaled content)\n\nCURRENT STATE:\n- Pocketbase running: http://localhost:8090 (78 profiles, 5 hardening)\n- Dev server: User will restart when needed\n- Planning complete: docs/taxonomy/taxonomy-transformation-plan.md\n- Current filters: 6 dropdowns (Category, Tech, Platform, Vendor, Standard, Search)\n- Issue: Current filters use old taxonomy (Platform = \"Cross Platform\" for 56 profiles)\n\nTAXONOMY DESIGN (docs/taxonomy/taxonomy-proposal.md):\n- Target Type: Operating System, Database, Web Server, Container, Virtualization, Cloud Service\n- Target Subtype: Linux, MySQL, Apache, Docker, ESXi, AWS, etc.\n- OS Family: Linux, Windows, Cross-Platform, Cloud-Native, N/A\n- Category: Operating Systems, Databases, Web Infrastructure, Container Platforms, etc.\n- Standard: STIG, CIS, SRG (already exists as relation)\n- Vendor: Microsoft, VMware, Red Hat, AWS, Google, Oracle (corrected)\n- Profile Maintainer: MITRE SAF, VMware, Google, Community\n\nNEXT SESSION - PHASE 1: Schema Updates (30 min):\n1. Start Pocketbase if not running: cd .pocketbase \u0026\u0026 ./pocketbase serve\n2. Open Pocketbase Admin UI: http://localhost:8090/_/\n3. Add new fields to profiles collection:\n   - target_type (text)\n   - target_subtype (text)\n   - os_family (text)\n   - profile_maintainer (text)\n4. Add same fields to hardening_profiles collection\n5. Can use Admin UI or create migration script (scripts/add-taxonomy-fields.ts)\n\nAFTER PHASE 1: Data Transformation (1.5 hrs):\n- Run transformation script with 40+ pattern matching rules\n- Transform 78 validation + 5 hardening profiles\n- Manual review of 10-20 edge cases\n- Verify coverage and export to git\n\nFULL PLAN: docs/taxonomy/taxonomy-transformation-plan.md\n\nFILES TO REVIEW:\n- docs/taxonomy/README.md - Overview\n- docs/taxonomy/taxonomy-proposal.md - Complete design\n- docs/taxonomy/taxonomy-visual.md - Visual mockups\n- docs/taxonomy/taxonomy-transformation-plan.md - 5-phase implementation\n\nGIT STATUS:\n- Uncommitted: ProfileFilters.vue, validate/index.md (dropdown fixes)\n- Should commit dropdown fixes before starting transformation","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-13T15:52:09.319943-05:00","created_by":"alippold","updated_at":"2026-01-13T15:52:09.319943-05:00"}
{"id":"saf-site-vitepress-42k","title":"Create home page layout with hero","description":"Build home page (/) with hero section, features grid, and getting started section. Use layout: page for full custom design.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T17:24:13.970896-05:00","created_by":"alippold","updated_at":"2026-01-12T19:59:02.845186-05:00","closed_at":"2026-01-12T19:59:02.845186-05:00","close_reason":"Home page already complete with hero, features, and content"}
{"id":"saf-site-vitepress-4ja","title":"Port composables from saf-site-v4","description":"## Port Composables from saf-site-v4\n\n**Goal:** Adapt existing composables to work with VitePress data loaders instead of Nuxt Content.\n\n**Source:** `/Users/alippold/github/mitre/saf-site-v4/app/composables/`\n\n**Target:** `docs/.vitepress/composables/`\n\n**Composables to Port:**\n\n### 1. useProfiles.ts (~170 lines)\n**What it provides:**\n- Computed filter lists: standards, categories, platforms, organizations\n- Computed counts: countsByStandard, countsByStatus\n- Filter function with multiple criteria\n- Search function (name, description, id)\n\n**Adaptation:**\n```typescript\n// OLD (Nuxt Content):\nconst files = await queryCollection\u003cProfilesFile\u003e('profiles').all()\n\n// NEW (VitePress data loader):\nimport { data } from '../loaders/profiles.data'\nconst profiles = computed(() =\u003e data.profiles)\n```\n\n**Reuse:** ~80% (only data source changes)\n\n### 2. useHardeningProfiles.ts (~150 lines)\nSimilar pattern to useProfiles but for hardening guides.\n\n**Reuse:** ~80%\n\n### 3. useStandards.ts (~100 lines)\nLoads and filters security standards.\n\n**Reuse:** ~80%\n\n### 4. useOrganizations.ts (~60 lines)\nOrganization metadata and filtering.\n\n**Reuse:** ~90% (pure utility functions)\n\n### 5. useTeams.ts (~55 lines)\nTeam metadata and filtering.\n\n**Reuse:** ~90%\n\n**Key Changes:**\n- Replace `queryCollection()` with data loader imports\n- Remove `loading` state (data loaded at build time)\n- Keep all filter/search/count logic (it's generic)\n- Update types to match schema.ts\n\n**Testing:**\n- Import in browse pages\n- Test filters work correctly\n- Verify computed values update reactively\n- Check TypeScript types are correct\n\n**Dependencies:** \n- Requires schema.ts (saf-site-vitepress-sc2)\n- Requires data loaders to be updated (saf-site-vitepress-l7u)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T19:37:49.815349-05:00","created_by":"alippold","updated_at":"2026-01-12T19:37:49.815349-05:00","dependencies":[{"issue_id":"saf-site-vitepress-4ja","depends_on_id":"saf-site-vitepress-sc2","type":"blocks","created_at":"2026-01-12T19:37:50.021434-05:00","created_by":"alippold"},{"issue_id":"saf-site-vitepress-4ja","depends_on_id":"saf-site-vitepress-l7u","type":"blocks","created_at":"2026-01-12T19:37:50.143123-05:00","created_by":"alippold"}]}
{"id":"saf-site-vitepress-5es","title":"Create apps showcase layout","description":"Build /apps landing page with app cards (Heimdall, Vulcan, SAF CLI). Similar to browse but with different card design.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T17:24:22.407154-05:00","created_by":"alippold","updated_at":"2026-01-12T17:24:22.407154-05:00"}
{"id":"saf-site-vitepress-76e","title":"Integrate Drizzle Studio for content editing","description":"## Drizzle Studio Integration - COMPLETED ✅\n\n**Solution:** Migrated from PGlite to SQLite with libsql client.\n\n**Current State:**\n- ✅ SQLite database with Drizzle ORM\n- ✅ Drizzle Studio works perfectly (all 12 tables visible)\n- ✅ libsql client (zero build dependencies, cross-platform)\n- ✅ sqlite-diffable integration for git-friendly exports\n- ✅ Complete contributor workflow ready\n\n**What Works:**\n- Visual editing via Drizzle Studio (localhost:4983)\n- Foreign key dropdowns in Studio\n- Schema validation\n- Round-trip: Studio → SQLite → dump → JSON → load → SQLite\n\n**Workflow:**\n1. `pnpm db:push` - Initialize database\n2. `pnpm studio` - Visual editor\n3. `pnpm db:dump` - Export to git-friendly JSON\n4. Commit diffable/ directory\n5. Other contributors: `pnpm db:load` - Import from JSON\n\n**Benefits Over PGlite:**\n- Works with Drizzle Studio (no compatibility issues)\n- Zero native compilation (better contributor experience)\n- Proven tooling (sqlite-diffable, 2+ years production)\n- Clean git diffs (JSON instead of binary)\n\n**Commits:**\n- 8895f4e: feat: migrate database from PGlite to SQLite\n- 980caba: feat: add sqlite-diffable for git-friendly database exports","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T19:26:15.574514-05:00","created_by":"alippold","updated_at":"2026-01-12T23:55:38.150257-05:00","closed_at":"2026-01-12T23:55:38.150257-05:00","close_reason":"Completed. Drizzle Studio working with SQLite + sqlite-diffable integration. Visual editing and git workflow ready."}
{"id":"saf-site-vitepress-7bi","title":"RECOVERY: Current Session Context","description":"SESSION 014 RECOVERY - 2026-01-13\n\nWORKFLOW:\nThis project uses BEADS for task tracking. See CLAUDE.md for VitePress development patterns.\n\nCOMPLETED THIS SESSION:\n- ✅ Fixed hardening YAML files (chef.yml, terraform.yml - changed profiles: to hardeningProfiles:)\n- ✅ Evaluated TrailBase vs Pocketbase for content management\n- ✅ REJECTED TrailBase: Poor schema handling, ER diagram broken, field types incorrect\n- ✅ APPROVED Pocketbase: FK UX validated with screenshot, version control viable\n- ✅ Researched correct Pocketbase API structure via agent (field options are DIRECT properties, not nested)\n- ✅ Created working Python script (scripts/create-collections-fixed.py)\n- ✅ Created test collections: organizations (3 records), profiles (1 record with FK)\n- ✅ Validated FK picker UX - shows organization NAMES in dropdown, searchable, inline editing\n- ✅ Confirmed sqlite-diffable approach for version control (same as libsql from session 013)\n\nCRITICAL DISCOVERY:\nPocketbase collection API structure - field properties are DIRECT, NOT nested in \"options\":\n```python\n{\n    \"name\": \"organization\",\n    \"type\": \"relation\",\n    \"collectionId\": org_id,      # DIRECT\n    \"cascadeDelete\": False,       # DIRECT\n    \"maxSelect\": 1                # DIRECT\n}\n```\n\nIN PROGRESS:\n- saf-site-vitepress-tay: Full Pocketbase implementation (Phase 1-5 plan)\n\nGIT STATUS:\n- Branch: main\n- Last commit: b07fdb9 (bd sync: 2026-01-13 00:18:40)\n- UNCOMMITTED WORK:\n  - content/data/hardening/chef.yml (hardeningProfiles key fixed)\n  - scripts/create-collections-fixed.py (working Python script)\n  - scripts/create-pocketbase-schema.py (Python with requests)\n  - scripts/delete-pocketbase-collections.ts (cleanup utility)\n  - scripts/test-relations.py, check-data.py, add-test-data.py\n  - .pocketbase/ directory (Pocketbase binary + test data)\n  - .gitignore updates\n\nPOCKETBASE STATE:\n- Installed: .pocketbase/pocketbase (v0.23.9)\n- Admin: admin@localhost.com / test1234567\n- Test collections exist: organizations (3 records), profiles (1 record)\n- Database: .pocketbase/pb_data/data.db\n\nNEXT STEPS (Priority Order):\n1. Commit current work (hardening fixes, Pocketbase setup, test scripts)\n2. Phase 1: Create all 12 collections with proper FK relations (30 mins)\n3. Phase 2: Import data using pb-cli (78 profiles, 18 standards, all reference data) (1 hour)\n4. Phase 3: Configure sqlite-diffable for version control (15 mins)\n5. Phase 4: Create CONTENT-EDITING.md documentation (15 mins)\n6. Phase 5: Update VitePress data loaders to read from Pocketbase (30 mins)\n\nBLOCKERS/NOTES:\n- Python SDK has parsing bugs but collections ARE created successfully (workaround: catch exceptions)\n- pb-cli recommended for Phase 2 import (avoids SDK issues)\n- All validation profiles have perfect data quality (0 duplicates, 0 missing fields)\n- Estimate: 2.5 hours total for full Pocketbase content management system\n\nKEY FILES:\n- scripts/create-collections-fixed.py - Working script with correct API structure\n- content/data/hardening/*.yml - Fixed hardeningProfiles key\n- saf-site-vitepress-tay - Full implementation plan card\n- YAML-STRUCTURE-DESIGN.md - Structure specification from agent analysis","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T12:30:00.293073-05:00","created_by":"alippold","updated_at":"2026-01-13T12:40:23.843255-05:00","closed_at":"2026-01-13T12:40:23.843255-05:00","close_reason":"Context recovered, ready to proceed with Pocketbase implementation"}
{"id":"saf-site-vitepress-bj4","title":"Implement dynamic routes for profile detail pages","description":"## Implement Dynamic Routes for Profile Detail Pages\n\n**Goal:** Replace manual markdown files with dynamic route generation for validation profiles.\n\n**Current State:**\n- Manual files: `rhel8-stig.md`, `ubuntu-20-cis.md`, `windows-server-2019-stig.md`\n- Each profile needs a separate markdown file (doesn't scale)\n\n**Target State:**\n- Single template: `docs/validate/profiles/[slug].md`\n- Paths generator: `docs/validate/profiles/[slug].paths.ts`\n- Automatically generates pages for all profiles from YAML data\n\n**Implementation:**\n\n1. Create template file `docs/validate/profiles/[slug].md`:\n```vue\n---\nlayout: doc\n---\n\u003cscript setup\u003e\nimport { useData } from 'vitepress'\nconst { params } = useData()\n\u003c/script\u003e\n\n# {{ params.name }}\n\n{{ params.description }}\n\n- **Category:** {{ params.category }}\n- **Technology:** {{ params.technology }}\n- **Version:** {{ params.version }}\n- **Maintainer:** {{ params.maintainer }}\n\n[View on GitHub]({{ params.github_url }})\n```\n\n2. Create paths generator `docs/validate/profiles/[slug].paths.ts`:\n```typescript\nimport { data } from '../../.vitepress/loaders/profiles.data'\n\nexport default {\n  paths() {\n    return data.profiles.map(profile =\u003e ({\n      params: profile\n    }))\n  }\n}\n```\n\n3. Update browse page links to use new route structure\n4. Delete manual profile markdown files\n5. Test all routes work correctly\n\n**Benefits:**\n- Scales to 100+ profiles automatically\n- Single source of truth (YAML data)\n- Consistent page structure\n- Easy to update template for all pages\n\n**Reference:** VitePress Dynamic Routes docs","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T18:45:37.744352-05:00","created_by":"alippold","updated_at":"2026-01-12T18:45:37.744352-05:00"}
{"id":"saf-site-vitepress-bje","title":"SESSION 014 Recovery Context","description":"SESSION 013 RECOVERY - 2026-01-13\n\nWORKFLOW:\nThis project uses BEADS for task tracking. See CLAUDE.md for VitePress development patterns.\n\nCOMPLETED THIS SESSION:\n- ✅ Migrated from PGlite to SQLite (libsql client, zero build deps)\n- ✅ Drizzle Studio working perfectly (all 12 tables visible)\n- ✅ sqlite-diffable integration (git-friendly exports)\n- ✅ Copied YAML data from saf-site-v4 to content/data/\n- ✅ Fixed CIS standards bug (singular → plural array)\n- ✅ Created OTHER standard for miscellaneous profiles\n- ✅ Import script with timestamp normalization\n\nDATA QUALITY ISSUES DISCOVERED:\n1. **Standard ID mismatches:**\n   - Profiles reference \"PCI-DSS\" but database has \"pci-dss\"\n   - Need consistent ID normalization (lowercase-with-dashes)\n\n2. **Missing required fields:**\n   - Some profiles missing technology, organization, team\n   - FK references point to non-existent records\n\n3. **YAML structure bugs:**\n   - CIS standards file had \"standard:\" (singular) instead of \"standards:\" (plural array)\n   - Fixed in our copy at content/data/standards/cis.yml\n\nCURRENT STATE:\n- SQLite database: .data/saf.db (partial data loaded)\n- Schema: 12 tables with foreign keys\n- Data files: content/data/* (copied and partially fixed)\n- Import script: scripts/import-from-v4.ts (needs FK normalization)\n- Commits: 980caba (sqlite-diffable), 8895f4e (SQLite migration)\n\nNEXT SESSION PRIORITIES:\n1. **Fix data quality issues:**\n   - Add ID normalization mapping in import script (PCI-DSS → pci-dss, CIS → CIS)\n   - Set missing FKs to NULL instead of failing\n   - Add default values for missing technology/organization/team\n\n2. **Complete import:**\n   - Run full import successfully (all profiles, hardening, etc.)\n   - Verify data in Drizzle Studio (pnpm studio)\n   - Run pnpm db:dump to generate diffable/ JSON\n\n3. **Test workflow:**\n   - Edit data in Studio\n   - Dump to JSON (pnpm db:dump)\n   - Commit and check git diff\n   - Load from JSON (pnpm db:load)\n   - Verify round-trip works\n\nFILES MODIFIED (uncommitted):\n- content/data/ (entire directory copied and fixed)\n- content/data/standards/cis.yml (fixed structure)\n- content/data/standards/other.yml (created)\n- scripts/import-from-v4.ts (updated to use local files)\n- package.json (added tsx, db:import-v4 script)\n- pnpm-lock.yaml (tsx dependency)\n\nGIT STATUS:\n- Branch: main\n- Last push: 980caba\n- Unstaged: content/data/, scripts/, package.json, pnpm-lock.yaml\n- **DO NOT COMMIT YET** - import incomplete, data quality issues remain\n\nBLOCKERS/NOTES:\n- Import failing on FK constraint violations\n- Need to handle invalid FK references gracefully\n- Python dependency (sqlite-diffable) needs documentation for contributors","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T00:17:06.847802-05:00","created_by":"alippold","updated_at":"2026-01-13T00:23:46.492848-05:00","closed_at":"2026-01-13T00:23:46.492848-05:00","close_reason":"Context recovered, ready to continue data import work"}
{"id":"saf-site-vitepress-bn9","title":"RECOVERY: Current Session Context","description":"SESSION 016 RECOVERY - 2026-01-13\n\nWORKFLOW:\nThis project uses BEADS for task tracking. VitePress POC evaluating replacement for Nuxt site.\n\nPOCKETBASE ARCHITECTURE:\n- Pocketbase 0.23.9 is single source of truth (not YAML)\n- Database version-controlled via sqlite-diffable (NDJSON format)\n- VitePress data loaders query Pocketbase REST API at build time\n- Content workflow: Edit in Pocketbase → Export DB → Commit → Build\n\nCOMPLETED THIS SESSION:\n✅ Phase 5 VitePress Integration (partial - 1.5 hours)\n- Updated ARCHITECTURE.md: Pocketbase as single source of truth\n- Updated CLAUDE.md: Content management patterns, data loader patterns\n- Updated profiles.data.ts: Query Pocketbase API with authentication\n- Fixed ProfileFilters.vue: Dynamic categories/technologies from real data\n- Successfully tested: 78 profiles loaded from Pocketbase with FK expansion\n- Dev server running with real data, dropdowns populated from database\n\nKEY DISCOVERIES:\n- VitePress data loaders can query Pocketbase REST API at build time\n- Authentication required: pb.admins.authWithPassword() for build access\n- FK expansion works: expand: 'technology,organization,team,standard'\n- Filter dropdowns now dynamic: Extract unique categories/tech from profiles\n- Technology filtering uses technology_name (display name) not ID\n\nIN PROGRESS:\n- saf-site-vitepress-tay: Phase 5 VitePress data loader integration (75% done)\n  - ✅ profiles.data.ts queries Pocketbase API\n  - ✅ Dynamic filter dropdowns working\n  - ⏳ Need to test category filtering (Platform Security, etc.)\n  - ⏳ Need to test technology filtering\n  - ⏳ Need to test search functionality\n  - ⏳ Create data loaders for hardening_profiles, standards, tools\n\nGIT STATUS:\n- Branch: main\n- Last commit: 8ad6fbe (bd sync: 2026-01-13 14:36:25)\n- Uncommitted: ProfileFilters.vue, validate/index.md (dropdown fixes)\n- Test scripts: create-all-collections*.py (not needed in git)\n- Pocketbase running: http://localhost:8090 (78 profiles imported)\n\nPOCKETBASE STATE:\n- Running at http://localhost:8090 with admin@localhost.com / test1234567\n- 12 collections with proper FK relations\n- 78 validation profiles, 5 hardening profiles, all reference data\n- All data imported and accessible via API\n- Database exported to .pocketbase/pb_data/diffable/ (46 files)\n\nNEXT STEPS (Priority Order):\n1. Commit dropdown fixes (ProfileFilters.vue, validate/index.md)\n2. Test filtering by category (Platform Security, Cloud Platform, etc.)\n3. Test filtering by technology (should show unique tech names)\n4. Test search functionality\n5. Create hardening_profiles.data.ts loader\n6. Create standards.data.ts loader\n7. Update remaining browse pages with real data\n\nBLOCKERS/NOTES:\n- Dev server works perfectly with Pocketbase API\n- Dropdowns now populate from real data (15 categories, multiple techs)\n- Need to verify filtering logic works correctly (technology_name matching)\n- Total session time: ~2 hours (under 2.5 hour estimate for Phase 5)\n\nCRITICAL FILES:\n- docs/.vitepress/loaders/profiles.data.ts: Queries Pocketbase API\n- docs/.vitepress/theme/components/ProfileFilters.vue: Dynamic dropdowns\n- docs/validate/index.md: Browse page with filtering\n- ARCHITECTURE.md: Complete Pocketbase architecture documentation\n- CLAUDE.md: Content management and data loader patterns","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T14:51:44.885548-05:00","created_by":"alippold","updated_at":"2026-01-13T14:55:40.85115-05:00","closed_at":"2026-01-13T14:55:40.85115-05:00","close_reason":"Context recovered, continuing Phase 5 testing"}
{"id":"saf-site-vitepress-brg","title":"SESSION 014 Recovery Context","description":"SESSION 014 RECOVERY - 2026-01-13\n\nWORKFLOW:\nThis project uses BEADS for task tracking. See CLAUDE.md for VitePress development patterns.\n\nCOMPLETED THIS SESSION:\n- ✅ Migrated database from PGlite to SQLite (libsql - zero build deps)\n- ✅ Integrated sqlite-diffable for git-friendly DB exports\n- ✅ Created comprehensive data quality Python script (duplicate detection, missing fields, FK validation, structural validation)\n- ✅ Fixed all data quality issues: 66 normalizations, 0 duplicates, 0 missing fields, 4 profiles manually fixed\n- ✅ Successfully imported all data: 78 validation profiles, 18 standards, 16 orgs, 8 techs, 4 teams, 52 tags\n- ✅ Discovered structural inconsistency: hardening files use wrong top-level keys\n- ✅ Spawned agents to analyze YAML structure and create comprehensive design document (YAML-STRUCTURE-DESIGN.md)\n\nCRITICAL DISCOVERY - YAML Structure Issues:\n- hardening/terraform.yml and chef.yml use \"profiles:\" (WRONG)\n- Should use \"hardeningProfiles:\" like ansible.yml\n- This caused 0 hardening profiles to import\n- Need to fix before proceeding\n\nDATA QUALITY ACHIEVEMENTS:\n- NO duplicate IDs across all entities\n- NO missing required fields (fixed 4 profiles manually)\n- ALL FKs normalized and consistent\n- Explicit ID mapping hash (CIS→cis, STIG→stig, etc.)\n- Backups created with timestamps\n- .gitignore updated automatically\n\nIN PROGRESS:\n- beads-tfc: YAML import/export utilities (blocked by structure standardization)\n\nGIT STATUS:\n- Branch: main\n- Last commit: b07fdb9 (beads sync)\n- UNCOMMITTED WORK:\n  - scripts/fix-yaml-data-quality.py (comprehensive quality script)\n  - scripts/import-from-v4.ts (YAML→SQLite import)\n  - content/data/ (all YAML files with quality fixes applied)\n  - YAML-STRUCTURE-DESIGN.md (agent-generated design doc)\n  - .gitignore, package.json, pnpm-lock.yaml\n  - .beads/issues.jsonl\n\nNEXT STEPS (Priority Order):\n1. FIX CRITICAL: Update hardening/terraform.yml and chef.yml to use \"hardeningProfiles:\" key\n2. Update quality script to validate top-level keys match directory expectations\n3. Re-run validation + import to verify hardening profiles load (expect ~5-10 profiles)\n4. Commit all changes (quality script, import script, data files, design doc)\n5. DECISION NEEDED: Consider pocketbase vs current SQLite+Drizzle approach for CMS-like editing\n\nBLOCKERS/NOTES:\n- At 6% context - must compact after committing\n- Pocketbase discussion: Getting close to CMS territory but want to avoid external services/databases\n- Current approach: SQLite + Drizzle Studio + sqlite-diffable (all self-contained, no external services)\n- Hardening import broken until top-level keys fixed (0 profiles imported vs expected ~5-10)\n- DB Browser for SQLite has FK dropdowns but font size issues for user\n- Data quality is PERFECT except for the 2 hardening files needing key rename\n\nKEY FILES:\n- scripts/fix-yaml-data-quality.py - Comprehensive quality checker with 4 validation phases\n- scripts/import-from-v4.ts - YAML→SQLite import with timestamp normalization\n- YAML-STRUCTURE-DESIGN.md - Full specification from agent analysis\n- .data/saf.db - SQLite database with all imported data\n- content/data/ - Source YAML files (copied from saf-site-v4, quality-fixed)\n\nVALIDATION SCRIPT CAPABILITIES:\n- Duplicate ID detection across all entity types\n- Missing required field detection\n- FK reference validation with explicit mapping\n- Structural validation (YAML keys)\n- Timestamped backups before any changes\n- Auto-updates .gitignore\n- Validation-only mode (--validate)\n- Dry-run mode (default)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T09:47:10.16849-05:00","created_by":"alippold","updated_at":"2026-01-13T12:27:14.760198-05:00","closed_at":"2026-01-13T12:27:14.760198-05:00","close_reason":"Context recovered, Pocketbase decision made and validated"}
{"id":"saf-site-vitepress-c6s","title":"EPIC: Core Pages","description":"Main site structure: home page, framework pages, apps pages, docs structure and navigation.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-12T17:23:50.070167-05:00","created_by":"alippold","updated_at":"2026-01-12T17:23:50.070167-05:00"}
{"id":"saf-site-vitepress-cei","title":"SESSION 011 Recovery Context","description":"SESSION 013 RECOVERY - 2026-01-13\n\nCOMPLETED THIS SESSION:\n- ✅ Migrated from PGlite to SQLite (libsql client, zero build deps)\n- ✅ Drizzle Studio working perfectly (all 12 tables visible)\n- ✅ sqlite-diffable integration (git-friendly exports)\n- ✅ Copied YAML data from saf-site-v4 to content/data/\n- ✅ Fixed CIS standards bug (singular → plural array)\n- ✅ Created OTHER standard for miscellaneous profiles\n- ✅ Import script with timestamp normalization\n\nDATA QUALITY ISSUES DISCOVERED:\n1. **Standard ID mismatches:**\n   - Profiles reference \"PCI-DSS\" but database has \"pci-dss\"\n   - Need consistent ID normalization (lowercase-with-dashes)\n\n2. **Missing required fields:**\n   - Some profiles missing technology, organization, team\n   - FK references point to non-existent records\n\n3. **YAML structure bugs:**\n   - CIS standards file had \"standard:\" (singular) instead of \"standards:\" (plural array)\n   - Fixed in our copy at content/data/standards/cis.yml\n\nCURRENT STATE:\n- SQLite database: .data/saf.db\n- Schema: 12 tables with foreign keys\n- Data files: content/data/* (copied and partially fixed)\n- Import script: scripts/import-from-v4.ts\n- Commits: 980caba (sqlite-diffable), 8895f4e (SQLite migration)\n\nNEXT SESSION PRIORITIES:\n1. **Fix data quality issues:**\n   - Normalize standard IDs (add mapping: PCI-DSS → pci-dss, etc.)\n   - Add missing technology/organization/team defaults\n   - Handle NULL FKs gracefully\n\n2. **Complete import:**\n   - Run full import successfully\n   - Verify data in Drizzle Studio\n   - Run pnpm db:dump to generate diffable/ JSON\n\n3. **Test workflow:**\n   - Edit data in Studio\n   - Dump to JSON\n   - Commit and check git diff\n   - Load from JSON\n   - Verify round-trip works\n\nFILES MODIFIED (uncommitted):\n- content/data/ (entire directory copied and fixed)\n- content/data/standards/cis.yml (fixed structure)\n- content/data/standards/other.yml (created)\n- scripts/import-from-v4.ts (updated to use local files)\n- package.json (added tsx, db:import-v4 script)\n\nGIT STATUS:\n- Branch: main\n- Last push: 980caba\n- Unstaged: content/data/, scripts/, package.json changes","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T17:33:48.169057-05:00","created_by":"alippold","updated_at":"2026-01-13T00:14:55.183048-05:00","closed_at":"2026-01-12T23:54:54.982891-05:00","close_reason":"Session recovered. Completed SQLite migration and sqlite-diffable integration. Database infrastructure ready for content editing."}
{"id":"saf-site-vitepress-dfg","title":"Set up asset directory structure","description":"## Set Up Asset Directory Structure\n\n**Goal:** Establish organized asset directory for images, icons, and downloadable files.\n\n**Target Structure:**\n```\ndocs/public/\n├── img/\n│   ├── logos/\n│   │   ├── mitre-saf.png (already exists)\n│   │   ├── mitre-saf-dark.png\n│   │   └── mitre-saf-icon.svg\n│   ├── icons/\n│   │   ├── linux.svg\n│   │   ├── windows.svg\n│   │   ├── cloud.svg\n│   │   └── database.svg\n│   └── badges/\n│       └── (future: status badges)\n└── downloads/\n    └── (future: PDF guides)\n```\n\n**Implementation:**\n\n1. Create directory structure in `docs/public/`\n2. Verify existing logo reference works: `/img/logos/mitre-saf.png`\n3. Add technology icons for Linux, Windows, Cloud, Database\n4. Update ProfileCard component to use icons if needed\n5. Document asset referencing pattern in code comments\n\n**Usage Pattern:**\n```vue\n\u003c!-- In components/markdown --\u003e\n\u003cimg src=\"/img/icons/linux.svg\" alt=\"Linux\"\u003e\n\n\u003c!-- In config --\u003e\nlogo: '/img/logos/mitre-saf.png'\n```\n\n**Key Rules:**\n- Use root-absolute paths: `/img/logo.png`\n- Don't include `/public/` in paths\n- VitePress handles hashing in production\n- Keep assets organized by type\n\n**Benefits:**\n- Organized asset management\n- Clear conventions for all developers\n- Easy to add new assets\n- Consistent paths across project","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T18:45:42.728528-05:00","created_by":"alippold","updated_at":"2026-01-12T18:45:42.728528-05:00"}
{"id":"saf-site-vitepress-dqt","title":"EPIC: Content Migration","description":"Get real data from saf-site-v4: copy YAML files, set up data loaders, generate individual detail pages.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-12T17:23:47.214903-05:00","created_by":"alippold","updated_at":"2026-01-12T17:23:47.214903-05:00","dependencies":[{"issue_id":"saf-site-vitepress-dqt","depends_on_id":"saf-site-vitepress-bj4","type":"blocks","created_at":"2026-01-12T18:46:01.134304-05:00","created_by":"alippold"},{"issue_id":"saf-site-vitepress-dqt","depends_on_id":"saf-site-vitepress-l7u","type":"blocks","created_at":"2026-01-12T18:46:10.917929-05:00","created_by":"alippold"}]}
{"id":"saf-site-vitepress-dst","title":"Create framework page layout","description":"Build framework pages (Plan, Harden, Validate, Normalize, Visualize). Use layout: doc with proper typography and prose styling.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T17:24:19.502611-05:00","created_by":"alippold","updated_at":"2026-01-12T17:24:19.502611-05:00"}
{"id":"saf-site-vitepress-l7u","title":"Expand data loaders for all content types","description":"## Expand Data Loaders for All Content Types\n\n**Goal:** Create data loaders for hardening guides, standards, and frameworks (not just validation profiles).\n\n**Current State:**\n- ✅ Validation profiles loader: `docs/.vitepress/loaders/profiles.data.ts`\n- ❌ No loaders for other content types\n\n**Target State:**\n```\ndocs/.vitepress/loaders/\n├── profiles.data.ts (exists)\n├── hardening.data.ts (new)\n├── standards.data.ts (new)\n└── frameworks.data.ts (new)\n```\n\n**Implementation:**\n\n1. **Hardening Guides Loader** (`hardening.data.ts`):\n```typescript\nimport { defineLoader } from 'vitepress'\n\ninterface HardeningGuide {\n  id: string\n  slug: string\n  name: string\n  description: string\n  platform: string\n  version: string\n  github_url: string\n}\n\nexport default defineLoader({\n  watch: ['../../content/data/hardening/*.yml'],\n  async load(): Promise\u003c{ guides: HardeningGuide[] }\u003e {\n    // Load and parse YAML files\n    // Return typed data\n  }\n})\n```\n\n2. **Standards Loader** (`standards.data.ts`):\n```typescript\ninterface Standard {\n  id: string\n  slug: string\n  name: string\n  organization: string\n  description: string\n  url: string\n}\n\nexport default defineLoader({\n  watch: ['../../content/data/standards/*.yml'],\n  async load(): Promise\u003c{ standards: Standard[] }\u003e {\n    // Load standards data\n  }\n})\n```\n\n3. **Frameworks Loader** (`frameworks.data.ts`):\n```typescript\ninterface Framework {\n  id: string\n  name: string\n  phases: string[]\n  description: string\n}\n\nexport default defineLoader({\n  watch: ['../../content/data/frameworks/*.yml'],\n  async load(): Promise\u003c{ frameworks: Framework[] }\u003e {\n    // Load framework data\n  }\n})\n```\n\n**Testing:**\n- Import data in components to verify types\n- Check hot-reload works when YAML changes\n- Verify build-time data transformation\n\n**Benefits:**\n- Consistent data loading pattern\n- Type-safe imports everywhere\n- Single source of truth (YAML files)\n- Hot-reload during development\n- Ready for dynamic route generation\n\n**Dependency:** Requires YAML data from saf-site-v4 (Content Migration epic)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T18:45:46.90197-05:00","created_by":"alippold","updated_at":"2026-01-12T18:45:46.90197-05:00","dependencies":[{"issue_id":"saf-site-vitepress-l7u","depends_on_id":"saf-site-vitepress-m6x","type":"blocks","created_at":"2026-01-12T19:46:42.072302-05:00","created_by":"alippold"}]}
{"id":"saf-site-vitepress-m6x","title":"Create YAML file validation schemas (Zod)","description":"## Create YAML File Validation Schemas\n\n**Goal:** Build Zod schemas to validate YAML file structure (wrapper + arrays).\n\n**Location:** `docs/.vitepress/database/yaml-schemas.ts`\n\n**Problem:**\n- Database schema defines individual rows (Profile, HardeningProfile, etc.)\n- YAML files have wrapper structure (_id, _metadata, array of items)\n- Need to validate YAML file format when loading\n\n**Pattern:**\n```typescript\nimport { z } from 'zod'\nimport { insertProfileSchema, insertHardeningProfileSchema } from './schema'\n\n// Validation Profiles YAML File\nexport const ProfilesFileSchema = z.object({\n  _id: z.string(),\n  _metadata: z.object({\n    standard: z.string().optional(),\n    description: z.string().optional()\n  }).optional(),\n  profiles: z.array(insertProfileSchema)  // Reuse drizzle-zod schema\n})\n\nexport type ProfilesFile = z.infer\u003ctypeof ProfilesFileSchema\u003e\n\n// Hardening Profiles YAML File\nexport const HardeningFileSchema = z.object({\n  _id: z.string(),\n  _metadata: z.object({\n    framework: z.string().optional(),\n    technology: z.string().optional(),\n    description: z.string().optional(),\n    lastUpdated: z.string().optional(),\n    team: z.string().optional(),\n    organization: z.string().optional(),\n    logo: z.string().optional()\n  }).optional(),\n  profiles: z.array(insertHardeningProfileSchema)\n})\n\nexport type HardeningFile = z.infer\u003ctypeof HardeningFileSchema\u003e\n\n// Standards, Organizations, Teams, etc.\n// ... similar pattern for each YAML file type\n```\n\n**Usage in Data Loaders:**\n```typescript\nimport { parse } from 'yaml'\nimport { ProfilesFileSchema } from '../database/yaml-schemas'\n\nexport default defineLoader({\n  async load() {\n    const content = await readFile('profiles/stig.yml', 'utf-8')\n    const parsed = parse(content)\n    \n    // Validate YAML structure\n    const validated = ProfilesFileSchema.parse(parsed)\n    \n    return { profiles: validated.profiles }\n  }\n})\n```\n\n**Files to Create Schemas For:**\n- profiles/*.yml → ProfilesFileSchema\n- hardening/*.yml → HardeningFileSchema\n- standards/*.yml → StandardsFileSchema\n- organizations/*.yml → OrganizationsFileSchema\n- teams/*.yml → TeamsFileSchema\n- tools/*.yml → ToolsFileSchema\n- technologies/*.yml → TechnologiesFileSchema\n- tags/*.yml → TagsFileSchema\n\n**Benefits:**\n- Runtime validation of YAML format\n- Type-safe YAML loading\n- Reuses drizzle-zod schemas for individual items\n- Catches malformed YAML at build time\n\n**Dependencies:** Requires schema.ts (saf-site-vitepress-sc2)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T19:46:28.962175-05:00","created_by":"alippold","updated_at":"2026-01-12T19:55:32.654679-05:00","closed_at":"2026-01-12T19:55:32.654679-05:00","close_reason":"Closed","dependencies":[{"issue_id":"saf-site-vitepress-m6x","depends_on_id":"saf-site-vitepress-sc2","type":"blocks","created_at":"2026-01-12T19:46:41.831558-05:00","created_by":"alippold"}]}
{"id":"saf-site-vitepress-mk8","title":"EPIC: Content Management \u0026 Schema","description":"Self-sufficient content management: Port schema.ts (Drizzle + Zod) from saf-site-v4, YAML import/export utilities, external Zod Studio for editing. VitePress must be able to manage its own content.","status":"open","priority":0,"issue_type":"epic","created_at":"2026-01-12T19:10:23.119905-05:00","created_by":"alippold","updated_at":"2026-01-12T19:10:23.119905-05:00","dependencies":[{"issue_id":"saf-site-vitepress-mk8","depends_on_id":"saf-site-vitepress-sc2","type":"blocks","created_at":"2026-01-12T19:14:34.58435-05:00","created_by":"alippold"},{"issue_id":"saf-site-vitepress-mk8","depends_on_id":"saf-site-vitepress-tfc","type":"blocks","created_at":"2026-01-12T19:23:38.749758-05:00","created_by":"alippold"}]}
{"id":"saf-site-vitepress-npl","title":"Document browse page pattern","description":"## Browse Page Pattern\n\n**Purpose**: Full-width listing pages with filters, search, and interactive Vue components while maintaining VitePress doc typography.\n\n### Frontmatter Configuration\n\n```yaml\n---\ntitle: Page Title\nlayout: doc      # Use doc layout for proper typography (NOT page layout)\naside: false     # Disable TOC sidebar for full-width content\n---\n```\n\n**Why `layout: doc`?**\n- `layout: page` gives blank canvas with NO typography (h1, p tags are unstyled)\n- `layout: doc` provides proper VitePress typography but is narrow (688px default)\n- Solution: Use `doc` layout + override width constraints with CSS\n\n### CSS Overrides (in `docs/.vitepress/theme/custom.css`)\n\n```css\n/* Full-width doc layout for browse pages */\n.VPDoc .container {\n  max-width: 1400px !important;\n}\n\n.VPDoc .content {\n  max-width: none !important;\n}\n\n.VPDoc .content-container {\n  max-width: none !important;\n}\n```\n\nThese overrides apply globally to ALL pages using `layout: doc`, so any page with `aside: false` gets full width automatically.\n\n### Interactive Browse Page Structure\n\n**Example**: `docs/validate/index.md`\n\n1. **Vue Script Setup** (client-side reactivity):\n```vue\n\u003cscript setup\u003e\nimport { ref, computed } from 'vue'\nimport { data } from '../.vitepress/loaders/profiles.data'\n\nconst allProfiles = data.profiles\nconst selectedCategory = ref('all')\nconst filteredProfiles = computed(() =\u003e {\n  // Filter logic here\n})\n\u003c/script\u003e\n```\n\n2. **Data Loading** (build-time):\n- Use VitePress data loaders: `docs/.vitepress/loaders/profiles.data.js`\n- Data is loaded at build time and imported as static data\n- Client-side Vue handles filtering/search on the loaded data\n\n3. **Component Usage**:\n```vue\n\u003cProfileFilters @update:category=\"selectedCategory = $event\" /\u003e\n\u003cProfileCard v-for=\"profile in filteredProfiles\" :key=\"profile.id\" :profile=\"profile\" /\u003e\n```\n\n4. **Scoped Styles**:\n```vue\n\u003cstyle scoped\u003e\n.profile-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));\n  gap: 1.5rem;\n}\n\u003c/style\u003e\n```\n\n### When to Use This Pattern\n\nUse for:\n- ✅ Listing pages with filters (profiles, guides, apps)\n- ✅ Browse/catalog pages with search\n- ✅ Pages needing full-width card grids\n- ✅ Pages with client-side interactivity\n\nDon't use for:\n- ❌ Content-heavy documentation pages (use default `layout: doc` with sidebar)\n- ❌ Simple static pages (use `layout: page` if no typography needed)\n\n### Pattern Benefits\n\n1. **Typography**: Proper h1, h2, p styling from VitePress theme\n2. **Full-width**: Maximum screen real estate for grids\n3. **Interactive**: Client-side Vue reactivity works seamlessly\n4. **Performance**: Data loaded at build time, filters run client-side\n5. **Consistency**: Same pattern across all browse pages","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T17:24:16.742049-05:00","created_by":"alippold","updated_at":"2026-01-12T17:41:00.643815-05:00","closed_at":"2026-01-12T17:41:00.643815-05:00","close_reason":"Closed"}
{"id":"saf-site-vitepress-sc2","title":"Port Drizzle + Zod schema from saf-site-v4","description":"## Port Drizzle + Zod Schema from saf-site-v4\n\n**Goal:** Copy complete schema definition to establish data structure and validation.\n\n**Source:** `/Users/alippold/github/mitre/saf-site-v4/app/database/schema.ts`\n\n**Target:** `docs/.vitepress/database/schema.ts`\n\n**What to Copy:**\n- Complete Drizzle schema (tables, relations)\n- Zod schemas (createInsertSchema, createSelectSchema)\n- TypeScript type exports\n\n**Tables:**\n- tags\n- organizations\n- teams\n- technologies\n- standards\n- profiles (validation)\n- hardeningProfiles\n- tools\n- capabilities\n- Junction tables (profilesTags, validationToHardening, etc.)\n\n**Relations:**\n- All Drizzle relations for type-safe joins\n\n**Zod Schemas:**\n- Insert/Select schemas for all tables\n- Runtime validation\n\n**TypeScript Types:**\n- Type exports using $inferSelect/$inferInsert\n\n**Testing:**\n- Import schema in data loader\n- Verify types work in TypeScript\n- Test Zod validation with sample data\n\n**Dependencies:** None (first task in Content Management)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T19:14:34.367479-05:00","created_by":"alippold","updated_at":"2026-01-12T19:55:32.627597-05:00","closed_at":"2026-01-12T19:55:32.627597-05:00","close_reason":"Closed"}
{"id":"saf-site-vitepress-tay","title":"SESSION 015: Pocketbase Content Management Implementation","description":"# Pocketbase Content Management - Implementation Plan\n\n## DECISION MADE: Pocketbase is APPROVED\n\n**Why**: FK relation UX tested and validated - shows organization NAMES in picker, searchable, inline editing, good UX for managing ~100 profiles with relationships.\n\n**Critical Requirement Met**: Pocketbase SQLite database can be version controlled using sqlite-diffable (same as libsql approach from session 013).\n\n## CURRENT STATUS\n\n### Completed (Session 014)\n- ✅ Evaluated TrailBase vs Pocketbase (TrailBase rejected - poor schema handling)\n- ✅ Researched correct Pocketbase API structure (field options are DIRECT properties, not nested in \"options\")\n- ✅ Created working Python script that creates collections with proper field structure\n- ✅ Created test collections: organizations (with 3 test records), profiles (with FK to organizations)\n- ✅ Validated FK picker UX with screenshot - APPROVED by user\n- ✅ Confirmed sqlite-diffable approach works for version control\n\n### Technical Discovery - Pocketbase Collection API\n\n**Key insight from agent research**: Field-specific properties are DIRECT on field object, NOT nested in \"options\":\n\n```python\n{\n    \"name\": \"organization\",\n    \"type\": \"relation\",\n    \"required\": False,\n    \"collectionId\": org_id,      # DIRECT property\n    \"cascadeDelete\": False,       # DIRECT property\n    \"maxSelect\": 1                # DIRECT property\n}\n```\n\n**NOT**:\n```python\n{\n    \"name\": \"organization\",\n    \"type\": \"relation\",\n    \"options\": {  # WRONG!\n        \"collectionId\": org_id\n    }\n}\n```\n\n### Working Script\n`scripts/create-collections-fixed.py` - Creates collections with correct structure. Python SDK has parsing bugs reading responses but collections ARE created successfully.\n\n### Current Pocketbase State\n- Running at: http://localhost:8090\n- Admin: admin@localhost.com / test1234567\n- Test collections exist: organizations (3 records), profiles (1 record with FK)\n- Location: `.pocketbase/pb_data/data.db`\n\n## NEXT SESSION PLAN\n\n### Phase 1: Create Full Schema (30 mins)\n\nCreate all 12 collections with proper FK relations:\n\n**Base Collections** (no FKs):\n1. tags\n2. organizations  \n3. technologies\n4. standards\n5. capabilities\n\n**Collections with FKs**:\n6. teams (FK: organization)\n7. profiles (FKs: technology, organization, team, standard)\n8. hardening_profiles (FKs: technology, organization, team, standard)\n9. tools (FKs: technology, organization)\n\n**Junction Tables** (many-to-many):\n10. profiles_tags\n11. hardening_profiles_tags\n12. validation_to_hardening\n\n**Script to create**: Extend `scripts/create-collections-fixed.py` with all 12 collections using the correct field structure.\n\n### Phase 2: Import Data (1 hour)\n\nImport existing data from `content/data/*.yml`:\n- 78 validation profiles\n- 18 standards\n- 16 organizations\n- 8 technologies\n- 4 teams\n- 52 tags\n- 7 tools\n- 5 capabilities\n\n**Approach**: Reuse `scripts/import-from-v4.ts` logic but adapt for Pocketbase Python SDK.\n\n**Handle**: \n- YAML normalization (use existing quality fixes)\n- FK resolution (map IDs correctly)\n- Timestamp conversion\n- Hardening profiles structure (validationProfiles vs hardeningProfiles keys)\n\n### Phase 3: Version Control Setup (15 mins)\n\nConfigure sqlite-diffable for Pocketbase database:\n\n```bash\n# Export Pocketbase DB to git-friendly format\ncd .pocketbase/pb_data\nsqlite-diffable dump data.db\n\n# Creates:\n# - data.db.metadata.json (schema)\n# - data.db.ndjson (data)\n```\n\n**Update .gitignore**:\n```\n.pocketbase/pb_data/data.db\n.pocketbase/pb_data/data.db-wal\n.pocketbase/pb_data/data.db-shm\n.pocketbase/pb_data/logs.db*\n.pocketbase/pb_data/storage/\n```\n\n**Add to git**:\n```\ngit add .pocketbase/pb_data/data.db.metadata.json\ngit add .pocketbase/pb_data/data.db.ndjson\n```\n\n### Phase 4: Documentation (15 mins)\n\nCreate `CONTENT-EDITING.md`:\n- How to start Pocketbase\n- How to edit content in UI\n- How to export changes with sqlite-diffable\n- How to commit changes\n- How other devs restore the DB\n\n### Phase 5: VitePress Integration (30 mins)\n\nUpdate VitePress data loaders to read from Pocketbase:\n\n**Option A**: Export Pocketbase → JSON files, VitePress reads JSON (simple, works with existing loaders)\n\n**Option B**: VitePress data loaders query Pocketbase REST API directly (requires Pocketbase running during build)\n\n**Recommend Option A** for simplicity and build-time performance.\n\n## CRITICAL FILES\n\n### Working Scripts\n- `scripts/create-collections-fixed.py` - Creates collections with correct field structure\n- `scripts/delete-pocketbase-collections.ts` - Cleanup utility\n- `scripts/check-data.py` - Verify data exists\n- `scripts/test-relations.py` - Original test script\n\n### Data Sources\n- `content/data/profiles/*.yml` - 78 validation profiles\n- `content/data/hardening/*.yml` - Hardening profiles (need structure fix)\n- `content/data/standards/*.yml` - 18 standards\n- `content/data/organizations/*.yml` - 16 organizations\n- `content/data/technologies/*.yml` - 8 technologies\n\n### Quality Validation\n- `scripts/fix-yaml-data-quality.py` - Comprehensive validation (66 normalizations applied)\n- `YAML-STRUCTURE-DESIGN.md` - Structure specification from agent analysis\n\n## KNOWN ISSUES\n\n1. **Python SDK parsing bug**: SDK throws TypeError when reading relation field responses. WORKAROUND: Catch exception - collections ARE created successfully despite error.\n\n2. **Hardening profiles structure**: `hardening/terraform.yml` and `chef.yml` use wrong key (`profiles:` instead of `hardeningProfiles:`). Fixed in content/data but needs verification.\n\n3. **Data quality**: All validation profiles have perfect data quality (0 duplicates, 0 missing fields, all FKs normalized). Hardening profiles need import testing.\n\n## SUCCESS CRITERIA\n\n- [ ] All 12 collections created with proper schema\n- [ ] All 78 validation profiles imported with correct FK references\n- [ ] Organizations/standards/technologies/teams/tags imported\n- [ ] Hardening profiles imported and linked to validation profiles\n- [ ] FK dropdowns show names (not IDs) in Pocketbase UI\n- [ ] sqlite-diffable configured and tested\n- [ ] Changes committed to git with human-readable diffs\n- [ ] Documentation complete\n\n## DECISION LOG\n\n1. **TrailBase rejected**: Poor schema handling, ER diagram broken, field types incorrect\n2. **Pocketbase approved**: FK UX validated, version control viable, proven solution\n3. **sqlite-diffable for version control**: Same approach as libsql (already working)\n4. **Keep Drizzle schema.ts**: Source of truth for structure, generate Pocketbase schema from it\n\n## ESTIMATED TIME\n\n- Phase 1 (Schema): 30 mins\n- Phase 2 (Import): 1 hour\n- Phase 3 (Version control): 15 mins\n- Phase 4 (Docs): 15 mins\n- Phase 5 (VitePress): 30 mins\n\n**Total: ~2.5 hours** for complete Pocketbase content management system.\n\n## DEPENDENCIES\n\n- Pocketbase binary: `.pocketbase/pocketbase` (installed)\n- Python packages: pocketbase (installed)\n- sqlite-diffable: Already available from session 013\n- Existing data: `content/data/**/*.yml` (quality-validated)\n\n## ROLLBACK PLAN\n\nIf Pocketbase doesn't work out:\n1. Keep current SQLite + Drizzle approach\n2. Build minimal CRUD UI with Drizzle Studio or custom forms\n3. Fall back to manual YAML editing with quality validation\n\n## REFERENCE\n\n- Pocketbase docs: https://pocketbase.io/docs/\n- Agent research on collection API: Session 014, agent aa2e5cf\n- FK UX validation: Screenshot in session 014\n- sqlite-diffable: https://github.com/simonw/sqlite-diffable","status":"in_progress","priority":0,"issue_type":"task","created_at":"2026-01-13T12:26:26.334769-05:00","created_by":"alippold","updated_at":"2026-01-13T14:35:56.841969-05:00"}
{"id":"saf-site-vitepress-tfc","title":"Create YAML import/export utilities","description":"## Create YAML Import/Export Utilities\n\n**Goal:** Build utilities to load, validate, and export YAML content files.\n\n**Location:** `docs/.vitepress/utils/yaml.ts`\n\n**Features:**\n\n### 1. YAML Loader with Zod Validation\n```typescript\nimport { parse } from 'yaml'\nimport { insertProfileSchema } from '../database/schema'\n\nexport async function loadProfiles(yamlPath: string) {\n  const content = await readFile(yamlPath, 'utf-8')\n  const parsed = parse(content)\n  \n  // Validate each profile with Zod\n  const validated = parsed.profiles.map(p =\u003e \n    insertProfileSchema.parse(p)\n  )\n  \n  return validated\n}\n```\n\n### 2. YAML Exporter\n```typescript\nexport function exportToYAML(data: Profile[]) {\n  return stringify({\n    _id: 'profiles',\n    _metadata: { ... },\n    profiles: data\n  })\n}\n```\n\n### 3. Import from saf-site-v4\n```typescript\n// Copy YAML files from saf-site-v4/content/data/\n// to saf-site-vitepress/content/data/\nexport async function importFromV4() {\n  const sourcePath = '/path/to/saf-site-v4/content/data'\n  const targetPath = './content/data'\n  \n  // Copy all .yml files\n  // Validate during copy\n}\n```\n\n**Testing:**\n- Load sample YAML file\n- Validate with Zod schema\n- Export back to YAML\n- Round-trip test (load → export → load → compare)\n\n**Dependencies:** Requires schema.ts (saf-site-vitepress-sc2)","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-12T19:23:38.356292-05:00","created_by":"alippold","updated_at":"2026-01-12T19:23:38.356292-05:00","dependencies":[{"issue_id":"saf-site-vitepress-tfc","depends_on_id":"saf-site-vitepress-sc2","type":"blocks","created_at":"2026-01-12T19:23:38.636987-05:00","created_by":"alippold"},{"issue_id":"saf-site-vitepress-tfc","depends_on_id":"saf-site-vitepress-m6x","type":"blocks","created_at":"2026-01-12T19:46:41.950444-05:00","created_by":"alippold"}]}
{"id":"saf-site-vitepress-uab","title":"RECOVERY: Current Session Context","description":"SESSION 015 RECOVERY - 2026-01-13\n\nWORKFLOW:\nThis project uses BEADS for task tracking. See CLAUDE.md for VitePress development patterns and Pocketbase content management details.\n\nCOMPLETED THIS SESSION:\n✅ Phase 1 (30 mins): Created all 12 Pocketbase collections with proper FK relations\n  - Base: tags, organizations, technologies, standards, capabilities  \n  - With FKs: teams, profiles, hardening_profiles, tools\n  - Junction: profiles_tags, hardening_profiles_tags, validation_to_hardening\n  - Fixed TypeScript SDK: Use fields (not schema), relation options DIRECT (not nested in options)\n\n✅ Phase 2 (45 mins): Imported all data from YAML files\n  - 78 validation profiles, 5 hardening profiles\n  - 52 tags, 16 organizations, 8 technologies, 18 standards, 4 teams, 7 tools, 5 capabilities\n  - 92 profile-tag links, 25 hardening-tag links, 4 validation-hardening links\n  - All FK relationships properly resolved\n\n✅ Phase 3 (15 mins): Version control setup with sqlite-diffable\n  - Exported Pocketbase DB to git-friendly format\n  - 46 files in .pocketbase/pb_data/diffable/ (.metadata.json + .ndjson)\n  - Updated .gitignore for proper tracking\n\n✅ Phase 4 (15 mins): Documentation\n  - Created CONTENT-EDITING.md with complete workflow\n  - Covers editing, exporting, committing, troubleshooting\n\nIN PROGRESS:\n- saf-site-vitepress-tay: Full Pocketbase implementation (Phase 5 remaining)\n\nGIT STATUS:\n- Branch: main\n- Last commit: 7d4b384 (bd sync: 2026-01-13 13:39:11)\n- Previous commits: 95bdbad (Phase 3), 1a44d4f (Phase 1-2)\n- All work committed and pushed\n- Untracked: scripts/create-all-collections-simple.py, scripts/create-all-collections.py (test scripts)\n\nPOCKETBASE STATE:\n- Running at http://localhost:8090\n- Admin: admin@localhost.com / test1234567\n- 12 collections created with proper schema\n- All data imported and verified\n- Database exported to .pocketbase/pb_data/diffable/\n\nKEY DISCOVERIES:\n- Pocketbase TypeScript SDK uses 'fields' property (not 'schema')\n- Relation field options are DIRECT properties (not nested in 'options:' object)\n- Python SDK has parsing bugs but API calls succeed\n- pb-cli is for record CRUD, NOT schema management\n- sqlite-diffable exports to human-readable NDJSON (one record per line)\n\nNEXT STEPS (Priority Order):\n1. Phase 5 (30 mins): Update VitePress data loaders to read from Pocketbase\n   - Recommended: Export Pocketbase → JSON files, VitePress reads JSON at build time\n   - Alternative: VitePress data loaders query Pocketbase REST API directly\n2. Test VitePress browse pages with real Pocketbase data\n3. Verify FK expansion works in browse page filters\n\nBLOCKERS/NOTES:\n- Total time: 1.75 hours (under 2.5 hour estimate)\n- Pocketbase content management fully functional\n- All data now version-controlled in git as NDJSON\n- Next session should start with Phase 5 VitePress integration\n\nCRITICAL FILES:\n- scripts/create-all-collections.ts: Creates all 12 collections\n- scripts/import-yaml-data.ts: Imports YAML → Pocketbase\n- scripts/verify-collections.ts: Validates collection structure\n- .pocketbase/pb_data/diffable/: Git-tracked database export\n- CONTENT-EDITING.md: Content management documentation","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T13:40:06.50835-05:00","created_by":"alippold","updated_at":"2026-01-13T13:46:52.042032-05:00","closed_at":"2026-01-13T13:46:52.042032-05:00","close_reason":"Context recovered, starting Phase 5"}
{"id":"saf-site-vitepress-uen","title":"EPIC: Production Evaluation","description":"Final decision: Is VitePress production-ready for SAF? Test build performance, bundle size, search quality, deployment strategy.","status":"open","priority":3,"issue_type":"epic","created_at":"2026-01-12T17:23:52.893131-05:00","created_by":"alippold","updated_at":"2026-01-12T17:23:52.893131-05:00"}
{"id":"saf-site-vitepress-uw8","title":"EPIC: Component Library Decision","description":"## Decision: Reka UI\n\n**Chosen:** Reka UI 2.7.0 (already installed)\n\n**Why:**\n- Vue-native optimization (smaller bundle, better DX)\n- Works seamlessly with VitePress CSS variables\n- Transparency/visibility issues already solved\n- 45+ components, actively maintained\n- No additional dependencies (Tailwind not needed)\n\n**Alternatives Considered:**\n1. **Shadcn Vue** - Requires Tailwind CSS (conflicts with VitePress theme)\n2. **Headless UI** - Smaller component set, Vue is secondary to React\n3. **Ark UI** - Framework-agnostic (larger bundle), state machine complexity\n\n**Pattern Established:**\nSee ProfileFilters.vue for reference:\n- Use Reka UI primitives (SelectRoot, SelectTrigger, etc.)\n- Style with VitePress CSS variables (var(--vp-c-*))\n- Scoped styles in component\n- Full keyboard navigation and ARIA support\n\n**Status:** APPROVED - proceed with Reka UI for all components","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-01-12T17:23:27.010415-05:00","created_by":"alippold","updated_at":"2026-01-12T18:37:57.553819-05:00","closed_at":"2026-01-12T18:37:57.553819-05:00","close_reason":"Closed"}
{"id":"saf-site-vitepress-z90","title":"EPIC: Browse Pages","description":"Content listing pages with filters and search: validation profiles, hardening profiles, standards. All use layout: doc with aside: false pattern.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-12T17:23:44.493844-05:00","created_by":"alippold","updated_at":"2026-01-12T17:23:44.493844-05:00"}
