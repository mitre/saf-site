# Component Style Guide

This guide documents the patterns and conventions for creating Vue components with Histoire stories in the SAF Site project.

## Documentation Pattern (DRY)

We use automated documentation extraction to maintain a single source of truth. Documentation is written as JSDoc in the component file and automatically injected into story files.

### How It Works

```
Component.vue (JSDoc)  →  inject-story-docs  →  Component.story.vue (<docs> block)
                                ↓
                            Histoire Docs Panel
```

**Key Files:**
- `scripts/inject-story-docs.ts` - Extracts JSDoc and injects into stories
- `scripts/inject-story-docs.spec.ts` - Tests for the extraction logic

### Commands

```bash
pnpm story:docs    # Generate/update all story docs
pnpm story:dev     # Start Histoire dev server
```

## Component JSDoc Format

Use `@component` tag for `<script setup>` components (required for vue-docgen-api to extract the description).

### Required Structure

```vue
<script setup lang="ts">
/**
 * @component ComponentName - Brief one-line description.
 * Additional context about when/why to use this component.
 *
 * @example Basic usage
 * <ComponentName :prop="value" />
 *
 * @example With options
 * <ComponentName
 *   :items="data"
 *   variant="card"
 * />
 */

// Exports for consumers
export type { SomeType }

export interface ComponentNameProps {
  /** Description of the prop */
  propName: PropType
  /** Optional prop with default */
  optionalProp?: string
}

const props = withDefaults(defineProps<ComponentNameProps>(), {
  optionalProp: 'default'
})
</script>
```

### JSDoc Tags

| Tag | Purpose | Example |
|-----|---------|---------|
| `@component` | Component description (required for script setup) | `@component Button - Clickable action element.` |
| `@example` | Usage example (can have multiple) | `@example <Button>Click</Button>` |
| `@see` | Link to related docs | `@see https://shadcn-vue.com/...` |

### Prop Documentation

Document props in the TypeScript interface using JSDoc comments:

```typescript
export interface MyComponentProps {
  /** Array of items to display (required) */
  items: Item[]
  /** Logo size in pixels */
  size?: number
  /** Visual variant - 'default' | 'compact' | 'card' */
  variant?: 'default' | 'compact' | 'card'
}
```

## Generated Documentation Order

The `inject-story-docs` script generates markdown in this order:

1. **Title** - Component name (from `displayName`)
2. **Description** - From `@component` tag
3. **Usage** - From `@example` tags (code blocks)
4. **Props** - Table extracted from interface
5. **Events** - Table if component emits events
6. **Slots** - Table if component has named slots
7. **Types** - Exported interfaces/types
8. **Notes** - Other tags like `@see`

## Story File Structure

Story files (`.story.vue`) should focus on variants, not documentation:

```vue
<script setup lang="ts">
import MyComponent from './MyComponent.vue'

// Test data
const items = [
  { name: 'Item 1' },
  { name: 'Item 2' },
]
</script>

<template>
  <Story title="Category/MyComponent" :layout="{ type: 'single', iframe: true }">
    <Variant title="Default">
      <MyComponent :items="items" />
    </Variant>

    <Variant title="With Options">
      <MyComponent :items="items" variant="card" :showNames="true" />
    </Variant>

    <Variant title="Edge Case">
      <MyComponent :items="[]" />
    </Variant>
  </Story>
</template>

<!-- <docs> block is auto-generated by pnpm story:docs -->
```

### Story Organization

Stories are organized by category in the Histoire sidebar:

| Category | Components |
|----------|------------|
| `Display/` | LogoGrid, LogoMarquee, PillarBadge |
| `Layout/` | PageSection, ContentCard |
| `shadcn-vue/` | Button, Badge, Card, Input, Select |

### Variant Best Practices

1. **Default** - Show component with minimal props
2. **Feature variants** - One variant per major feature/prop
3. **Edge cases** - Empty state, loading, error, long content
4. **Responsive** - If layout changes, show mobile/desktop variants

## Interface Exports

Export interfaces for consumers to import:

```typescript
// In component
export type { LogoItem }

export interface LogoGridProps { ... }

// Consumer can import
import type { LogoItem, LogoGridProps } from '@/components/LogoGrid.vue'
```

## shadcn-vue Components

For shadcn-vue components, documentation focuses on project-specific usage patterns rather than duplicating upstream docs.

```vue
/**
 * @component Button - Versatile button from shadcn-vue.
 * Customized with MITRE branding and VitePress compatibility fixes.
 *
 * @example Primary action
 * <Button>Get Started</Button>
 *
 * @see https://www.shadcn-vue.com/docs/components/button
 */
```

## Testing

Component tests are colocated with source files:

```
components/
├── LogoGrid.vue
├── LogoGrid.story.vue
└── LogoGrid.spec.ts
```

## Workflow

1. **Create component** with JSDoc documentation
2. **Create story** with variants (no `<docs>` block)
3. **Run `pnpm story:docs`** to generate docs
4. **View in Histoire** to verify
5. **Commit** both component and story

## Troubleshooting

### Docs not appearing in Histoire
- Ensure `@component` tag is present (required for `<script setup>`)
- Run `pnpm story:docs` after component changes
- Restart Histoire if docs still don't appear

### Props not extracted
- Props must be in an exported interface
- Use `withDefaults(defineProps<Props>(), {...})` pattern

### @example not showing
- Each `@example` should be on its own line
- Multi-line examples work - content continues until next `@tag`

## Reference

- [Histoire Documentation](https://histoire.dev/guide/vue3/docs.html)
- [vue-docgen-api](https://vue-styleguidist.github.io/docs/Docgen.html)
- [Issue #680](https://github.com/histoire-dev/histoire/issues/680) - Why we inject docs instead of using sibling .story.md files
